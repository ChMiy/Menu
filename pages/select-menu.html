<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0D1B2A">
    <title>Select Menu</title>
    <link rel="manifest" href="../manifest.json">
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        [data-lang] {
            display: none;
        }
    </style>
    <script>
        // Show only the selected language content
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang') || 'en';
            
            // Hide all language versions first
            document.querySelectorAll('[data-lang]').forEach(el => {
                el.style.display = 'none';
            });
            
            // Show only the selected language
            document.querySelectorAll(`[data-lang="${lang}"]`).forEach(el => {
                el.style.display = 'block';
            });
        });
    </script>
</head>
<body>
    <div class="menu-selection">
        <div class="menu-panel" id="food-menu">
            <img src="../assets/images/backgrounds/food-menu-bg.jpg" alt="Food Menu Background">
            <div class="panel-content">
                <!-- English -->
                <div data-lang="en">
                    <h2 class="panel-title">Menu</h2>
                    <p class="panel-subtitle">Discover our dishes</p>
                </div>
                <!-- Portuguese -->
                <div data-lang="pt">
                    <h2 class="panel-title">Menu</h2>
                    <p class="panel-subtitle">Descubra os nossos pratos</p>
                </div>
                <!-- French -->
                <div data-lang="fr">
                    <h2 class="panel-title">Menu</h2>
                    <p class="panel-subtitle">Découvrez nos plats</p>
                </div>
                <!-- Spanish -->
                <div data-lang="es">
                    <h2 class="panel-title">Menú</h2>
                    <p class="panel-subtitle">Descubra nuestros platos</p>
                </div>
                <!-- German -->
                <div data-lang="de">
                    <h2 class="panel-title">Speisekarte</h2>
                    <p class="panel-subtitle">Entdecken Sie unsere Gerichte</p>
                </div>
            </div>
        </div>

        <div class="menu-divider"></div>

        <div class="menu-panel wine-panel" id="wine-menu">
            <img src="../assets/images/backgrounds/wine-menu-bg.jpg" alt="Wine Menu Background">
            <div class="panel-content">
                <!-- English -->
                <div data-lang="en">
                    <h2 class="panel-title">Wine List</h2>
                    <p class="panel-subtitle">Explore our cellar</p>
                </div>
                <!-- Portuguese -->
                <div data-lang="pt">
                    <h2 class="panel-title">Carta de Vinhos</h2>
                    <p class="panel-subtitle">Explore a nossa adega</p>
                </div>
                <!-- French -->
                <div data-lang="fr">
                    <h2 class="panel-title">Carte des Vins</h2>
                    <p class="panel-subtitle">Explorez notre cave</p>
                </div>
                <!-- Spanish -->
                <div data-lang="es">
                    <h2 class="panel-title">Carta de Vinos</h2>
                    <p class="panel-subtitle">Explore nuestra bodega</p>
                </div>
                <!-- German -->
                <div data-lang="de">
                    <h2 class="panel-title">Weinkarte</h2>
                    <p class="panel-subtitle">Erkunden Sie unseren Weinkeller</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/background-asset-detector.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // SINGLE ROBUST LOCALHOST DETECTION FUNCTION
            function isLocalhost() {
                const hostname = window.location.hostname;
                const port = window.location.port;
                
                // Check for localhost conditions
                const isLocalIP = hostname === 'localhost' || hostname === '127.0.0.1' || hostname === '::1';
                const isLocalPort = port === '8000' || port === '3000' || port === '8080' || port === '5000';
                const isFileProtocol = window.location.protocol === 'file:';
                
                // Also check if we're NOT on GitHub Pages domain
                const isGitHubPages = hostname.includes('github.io') || hostname.includes('githubusercontent.com');
                
                return (isLocalIP && isLocalPort) || isFileProtocol || (!isGitHubPages && port);
            }

            const basePath = isLocalhost() ? '' : '/Menu/';
            
            console.log('=== SELECT MENU FIXED DEBUG ===');
            console.log('hostname:', window.location.hostname);
            console.log('port:', window.location.port);
            console.log('isLocalhost():', isLocalhost());
            console.log('basePath:', basePath);
            console.log('timestamp:', new Date().toISOString());
            console.log('================================');

            // Get current language from URL
            function getLang() {
                const params = new URLSearchParams(window.location.search);
                return params.get('lang') || 'en';
            }

            // Handle menu panel clicks
            document.getElementById('food-menu').addEventListener('click', () => {
                const lang = getLang();
                // Since we're already in /pages/, we need to adjust the path
                const menuUrl = isLocalhost() ? `menu/menu-${lang}.html?lang=${lang}` : `${basePath}pages/menu/menu-${lang}.html?lang=${lang}`;
                console.log('=== FOOD MENU CLICK ===');
                console.log('basePath:', basePath);
                console.log('lang:', lang);
                console.log('isLocalhost():', isLocalhost());
                console.log('menuUrl:', menuUrl);
                console.log('=======================');
                window.location.href = menuUrl;
            });

            document.getElementById('wine-menu').addEventListener('click', () => {
                const lang = getLang();
                // Since we're already in /pages/, we need to adjust the path
                const wineUrl = isLocalhost() ? `wine/wine-${lang}.html?lang=${lang}` : `${basePath}pages/wine/wine-${lang}.html?lang=${lang}`;
                console.log('=== WINE MENU CLICK ===');
                console.log('basePath:', basePath);
                console.log('lang:', lang);
                console.log('isLocalhost():', isLocalhost());
                console.log('wineUrl:', wineUrl);
                console.log('=======================');
                window.location.href = wineUrl;
            });

            // Touch navigation
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;

            document.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            document.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].clientX;
                touchEndY = e.changedTouches[0].clientY;
                handleSwipe();
            }, { passive: true });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'Escape' || e.key === 'Home') {
                    navigateToHome();
                }
            });

            function handleSwipe() {
                const swipeDistanceX = touchEndX - touchStartX;
                const swipeDistanceY = touchEndY - touchStartY;
                const minSwipeDistance = 50;

                // Only handle horizontal swipes if they're more horizontal than vertical
                if (Math.abs(swipeDistanceX) > Math.abs(swipeDistanceY)) {
                    if (Math.abs(swipeDistanceX) > minSwipeDistance) {
                        if (swipeDistanceX > 0) {
                            // Swipe right -> go back to home
                            navigateToHome();
                        }
                    }
                }
            }

            function navigateToHome() {
                // Since we're already in /pages/, we need to go up one level for localhost
                const homeUrl = isLocalhost() ? '../index.html' : `${basePath}index.html`;
                window.location.href = homeUrl;
            }

            // Add hover effects
            function addHoverEffect(element) {
                element.addEventListener('mouseenter', () => {
                    const img = element.querySelector('img');
                    if (img) {
                        img.style.transform = 'scale(1.05)';
                        img.style.transition = 'transform 0.5s ease';
                    }
                });

                element.addEventListener('mouseleave', () => {
                    const img = element.querySelector('img');
                    if (img) {
                        img.style.transform = 'scale(1)';
                    }
                });
            }

            // Add touch effects
            function addTouchEffect(element) {
                element.addEventListener('touchstart', () => {
                    const img = element.querySelector('img');
                    if (img) {
                        img.style.transform = 'scale(1.02)';
                    }
                });

                element.addEventListener('touchend', () => {
                    const img = element.querySelector('img');
                    if (img) {
                        img.style.transform = 'scale(1)';
                    }
                });
            }

            // Initialize effects
            document.querySelectorAll('.menu-panel').forEach(panel => {
                addHoverEffect(panel);
                addTouchEffect(panel);
            });
        });
    </script>
</body>
</html> 